C51 COMPILER V9.57.0.0   ONE_WIRE                                                          02/09/2026 12:59:35 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE ONE_WIRE
OBJECT MODULE PLACED IN .\Objects\one_wire.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE one_wire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -one_wire.lst) OBJECT(.\Objects\one_wire.obj)

line level    source

   1          
   2          // Header:单总线通信驱动程序
   3          // File Name: 
   4          // Author:WYC
   5          // Date:2026 1.28
   6          
   7          #include <STC15F2K60S2.H>
   8          #include <intrins.h> 
   9          sbit onewire_DQ=P1^4;
  10          
  11          void Delay10us(void)    //@12.000MHz
  12          {
  13   1              unsigned char data i;
  14   1      
  15   1              _nop_();
  16   1              _nop_();
  17   1              i = 27;
  18   1              while (--i);
  19   1      }
  20          
  21          void Delay50us(void)    //@12.000MHz
  22          {
  23   1              unsigned char data i;
  24   1      
  25   1              _nop_();
  26   1              _nop_();
  27   1              i = 147;
  28   1              while (--i);
  29   1      }
  30          
  31          void Delay5us(void)     //@12.000MHz
  32          {
  33   1              unsigned char data i;
  34   1      
  35   1              _nop_();
  36   1              _nop_();
  37   1              i = 12;
  38   1              while (--i);
  39   1      }
  40          
  41          
  42          
  43          void Delayus(unsigned int xus)  //@12.000MHz
  44          {
  45   1              unsigned char tem=xus/5;
  46   1              unsigned char data i;
  47   1              while(tem--)
  48   1              {
  49   2                      _nop_();
  50   2                      _nop_();
  51   2                      i = 12;
  52   2                      while (--i);
  53   2              }
  54   1      
C51 COMPILER V9.57.0.0   ONE_WIRE                                                          02/09/2026 12:59:35 PAGE 2   

  55   1      }
  56          
  57          unsigned char onewire_init(void)
  58          {
  59   1              unsigned char ackbit;
  60   1              onewire_DQ=1;
  61   1              onewire_DQ=0;
  62   1              Delayus(500);
  63   1              onewire_DQ=1;
  64   1              Delayus(70);
  65   1              ackbit=onewire_DQ;
  66   1              Delayus(500);
  67   1              return ackbit;
  68   1      }
  69          
  70          void onewire_sendbit(unsigned char Bit)
  71          {
  72   1              onewire_DQ=0;
  73   1              Delay10us();
  74   1              onewire_DQ=Bit;
  75   1              Delay50us();
  76   1              onewire_DQ=1;
  77   1      }
  78          
  79          unsigned char onewire_receivebit(void)
  80          {
  81   1              unsigned char Bit;
  82   1              onewire_DQ=0;
  83   1              Delay5us();
  84   1              onewire_DQ=1;
  85   1              Delay5us();
  86   1              Bit=onewire_DQ;
  87   1              Delay50us();
  88   1              return Bit;
  89   1      }
  90          
  91          void onewire_sendbyte(unsigned char byte)
  92          {
  93   1              unsigned char i;
  94   1              for(i=0;i<8;i++)
  95   1              {
  96   2                      onewire_sendbit(byte&(0x01<<i));
  97   2              }
  98   1      }
  99          
 100          unsigned char onewire_receivebyte(void)
 101          {
 102   1      
 103   1              unsigned char i;
 104   1              unsigned char byte=0x00;
 105   1              for(i=0;i<8;i++)
 106   1              {
 107   2                      if(onewire_receivebit()){byte|=(0x01<<i);}
 108   2              }
 109   1              return byte;
 110   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    172    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.57.0.0   ONE_WIRE                                                          02/09/2026 12:59:35 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
